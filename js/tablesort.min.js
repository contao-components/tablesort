var SORT_INDEX,THOUSANDS_SEPARATOR=",",DECIMAL_SEPARATOR=".",TableSort=new Class({initialize:function(e,l,s){if(l&&(THOUSANDS_SEPARATOR=l),s&&(DECIMAL_SEPARATOR=s),!(!e.rows||e.rows.length<1||!e.tHead||e.tHead.rows.length<1)){var a=null,t=this,r=window.localStorage.getItem("tablesort_"+e.get("id"));if(r)a=r.split("|");else{var n=e.get("data-sort-default");n&&(a=n.split("|"))}for(var c=e.tHead.rows[e.tHead.rows.length-1],o=0;o<c.cells.length;o++)if(-1==c.cells[o].className.indexOf("unsortable")){var i=c.cells[o],d=new Element("a").addClass("pointer");d.innerHTML=i.innerHTML,i.innerHTML="",d.addEvent("click",function(e,l){t.resort(e,l)}.pass([o,i])).inject(i),a&&a[0]==o&&($(i).addClass("desc"==a[1]?"asc":"desc"),t.resort(a[0],i))}}},resort:function(e,l){var s=$(l);if(null!=s){var a=s.getParent("tr"),t=a.getParent("table");if(!(null==t||t.tBodies[0].rows.length<2)){SORT_INDEX=e;for(var r,n=0,c="";""==c&&t.tBodies[0].rows[n];)c=t.tBodies[0].rows[n].cells[e].innerHTML.replace(/<[^>]+>/g,"").clean(),n++;var o=[];for(n=0;n<t.tBodies[0].rows.length;n++)o[n]=t.tBodies[0].rows[n];-1!=l.className.indexOf("date")||c.match(/^\d{1,4}[\/\. -]\d{1,2}[\/\. -]\d{1,4}$/)?o.sort(this.sortDate):-1!=l.className.indexOf("currency")||c.match(/^[£$€Û¢´]/)||c.match(/^-?[\d\.,]+[£$€]$/)?o.sort(this.sortNumeric):-1!=l.className.indexOf("numeric")||c.match(/^-?[\d\.,]+(E[-+][\d]+)?$/)||c.match(/^-?[\d\.,]+%?$/)?o.sort(this.sortNumeric):o.sort(this.sortCaseInsensitive);var i,d=a.getChildren();if(-1==l.className.indexOf("asc")){for(n=0;n<d.length;n++)d[n].removeClass("asc"),d[n].removeClass("desc");l.addClass("asc"),window.localStorage.setItem("tablesort_"+t.id,e+"|asc")}else{for(n=0;n<d.length;n++)d[n].removeClass("asc"),d[n].removeClass("desc");l.addClass("desc"),window.localStorage.setItem("tablesort_"+t.id,e+"|desc"),o.reverse()}for(n=0;n<o.length;n++){for(i=(i=o[n].className).replace(/row_\d+/,"").replace(/odd|even|row_first|row_last/g,"").clean(),i+=" row_"+n,0==n&&(i+=" row_first"),n>=o.length-1&&(i+=" row_last"),i+=n%2==0?" odd":" even",o[n].className=i.trim(),r=0;r<o[n].cells.length;r++)i=(i=o[n].cells[r].className).replace(/col_\d+/,"").replace(/odd|even|col_first|col_last/g,"").clean(),i+=" col_"+r,0==r&&(i+=" col_first"),r>=o[n].cells.length-1&&(i+=" col_last"),o[n].cells[r].className=i.trim();t.tBodies[0].appendChild(o[n])}}}},sortDate:function(e,l){var s,a,t=e.cells[SORT_INDEX].innerHTML.replace(/<[^>]+>/g,"").clean(),r=l.cells[SORT_INDEX].innerHTML.replace(/<[^>]+>/g,"").clean(),n=t.replace(/[\/\.-]/g," ").split(" "),c=r.replace(/[\/\.-]/g," ").split(" ");return t.match(/^\d{1,2}[\/\. -]\d{1,2}[\/\. -]\d{2,4}$/)&&(s=(4==n[2].length?n[2]:"19"+n[2])+(2==n[1].length?n[1]:"0"+n[1])+(2==n[0].length?n[0]:"0"+n[0]),a=(4==c[2].length?c[2]:"19"+c[2])+(2==c[1].length?c[1]:"0"+c[1])+(2==c[0].length?c[0]:"0"+c[0])),t.match(/^\d{2,4}[\/\. -]\d{1,2}[\/\. -]\d{1,2}$/)&&(s=(4==n[0].length?n[0]:"19"+n[0])+(2==n[1].length?n[1]:"0"+n[1])+(2==n[2].length?n[2]:"0"+n[2]),a=(4==c[0].length?c[0]:"19"+c[0])+(2==c[1].length?c[1]:"0"+c[1])+(2==c[2].length?c[2]:"0"+c[2])),s==a?0:s<a?-1:1},sortNumeric:function(e,l){var s=new RegExp("\\"+THOUSANDS_SEPARATOR,"g"),a=e.cells[SORT_INDEX].innerHTML.replace(s,""),t=l.cells[SORT_INDEX].innerHTML.replace(s,"");return"."!=DECIMAL_SEPARATOR&&(a=a.replace(DECIMAL_SEPARATOR,"."),t=t.replace(DECIMAL_SEPARATOR,".")),a=a.replace(/<[^>]+>/).replace(/[^0-9\.,-]/g,"").clean(),t=t.replace(/<[^>]+>/).replace(/[^0-9\.,-]/g,"").clean(),a=parseFloat(a),isNaN(a)&&(a=0),t=parseFloat(t),isNaN(t)&&(t=0),a-t},sortCaseInsensitive:function(e,l){var s=e.cells[SORT_INDEX].innerHTML.replace(/<[^>]+>/g,"").clean().toLowerCase(),a=l.cells[SORT_INDEX].innerHTML.replace(/<[^>]+>/g,"").clean().toLowerCase();return s==a?0:s<a?-1:1}});